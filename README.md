# Bandwagon

> 不要炒股票——详解只做ETF一年翻倍的花车理论 - 矩阵的文章 - 知乎
> https://zhuanlan.zhihu.com/p/475647897

该项目依据花车理论，只适用于宽基指数ETF，首先针对其成分股进行强弱势预测，然后再根据成分股的权重，得到ETF的强弱势。

# 1 上量、下量、放量、缩量的概念

|        | （价格）上 | （价格）下 |
| ------ | ----- | ----- |
| （成交量）缩 | 将转弱   | 将转强   |
| （成交量）放 | 转强    | 转弱    |

拿正弦曲线来说明：

```python
import numpy as np
x = np.linspace(0,10,100)
y = np.sin(x)
import matplotlib.pyplot as plt
import matplotlib as mpl
mpl.rc("font",family='Heiti TC',weight="bold")
plt.rcParams['font.sans-serif'] = ['SimHei']
# plt.rcParams['axes.unicode_minus'] = False
plt.plot(x,y)
plt.hlines(0,0,10)
plt.text(0,0.5,"上缩")
plt.text(2,0.5,"下放")
plt.text(3,-0.5,"下缩")
plt.text(5,-0.5,"上放")
plt.text(6,0.5,"上缩")
plt.text(8,0.5,"下放")
```

也就是说：

- 上下：价格的相对值

- 缩放：量能的相对值

两者产生4个组合。

# 2 量能

价格：上 vs. 下

量能：

- 与前一天同一个小时做对比  $V_t^d-V_t^{d-1}>0$ , or $<0$

- 与前半小时做对比（引入相对系数$\alpha$）$V_t^d-\alpha V_{t-1}^{d}>0$ or $<0$

where $\alpha_t = \overline V_1^d/\overline V_{0}^{d}, t=1,2,3,...$ 

$\alpha_t$为大盘近几年同日时间段的对比系数。大盘近几年开盘第一个半小时与第二个半小时的量能比例，得到平均值，比如第二根占第一根的60%（只是比如，你自己去算，周期越长越好），那比较时就用第一根量乘0.6再和第二根比，我的结果是昨天的第二根是放量的，得到了放量+下量的结论，给予弱势评分。

# 3 Modeling

- strength() 
  
  个股强弱评分 = 成交量评分\*0.3 + 所在板块交叉评分\*0.3 + 大盘评分\*0.2+股票惯性(势)\*0.2
  
  注1：个股有可能属于多个板块，平均即可。
  
  注2：板块的强弱计算，和个股一样，也是以半小时线为基础做判断

- vote()
  
  ETF强弱评分 = $\sum w_i \cdot$个股强弱评分

这样的话，每天都会有一个这样的表格： 

| 代码     | 名称   | 权重$w$ | 量能评分 $\cdot \alpha$ | 板块评分$\cdot\beta$ | 大盘评分$\cdot\gamma$ | 股票惯性$\cdot \eta$ | 个股评分=前4列加权和          |
| ------ | ---- | ----- | ------------------- | ---------------- | ----------------- | ---------------- | -------------------- |
| 600900 | 长江电力 | 3.71  |                     |                  |                   |                  |                      |
| 600010 | 包钢股份 | 0.697 |                     |                  |                   |                  |                      |
| 600690 | 海尔智家 | 1.428 |                     |                  |                   |                  |                      |
| 600028 | 中国石化 | 0.932 |                     |                  |                   |                  |                      |
| 600346 | 恒力石化 | 0.545 |                     |                  |                   |                  |                      |
| ...    |      |       |                     |                  |                   |                  |                      |
|        |      |       |                     | etf总评分：          |                   |                  | $\sum w_i\cdot$个股i评分 |

## 关于大盘：

大盘的放量和缩量是很好确定的，把两市成交额填进表格与昨天和上个时段比较就行了。

比较复杂的是上量还是下量。作者对于大盘有个非线性地计算：量级内部涨幅越高的给予的权重也越高，跌幅越大的给予的权重也越大。也就是说是将原来权重扩大。这里可以用softmax()一次搞定。

具体做法是：在自选股里建成几个分类，把所有4000多支股票按流通市值（更讲究的也可按流通股本*股价的，比较复杂没有必要）排序后分成各个档位，比如万亿级、五千亿级、百亿级等，分别放进各个分类。然后就简单了，比如早上十点，我们可以去看五千亿级涨了10%的有多少家，6%的有多少家，跌了5%的有多少家，分别在矩阵中用家数乘上不同的权重，就能得出五千亿级的强弱。注意一定要给予涨跌幅更大的股票更更大的权重。在tushare/baostock中可能更好做，获取两市4000多只股票['代码','名称','市值','当日涨跌幅']，市值作为基础权重，然后再根据当日涨跌幅做个非线性放大即可。

**另外，大盘需要独立监测:**

1、进场时，我们需要大盘强势，ETF强势。

2、持有过程中，不管ETF是否强弱，大盘必须强势。

3、出场时，大盘转弱则必须出场。

总结：**只在大盘强时持仓**。

## 关于量能：

- 上量下量你导入或输入那半小时的开盘价收盘价比大小就行了（价格 涨vs.跌）

- 缩量放量你导入或输入那半小时的量能，然后做一下与昨天同时段的对比、与上根线乘上系数的对比（交易量 vs. 昨天同时段 vs. 上一时刻交易量$\alpha$）。还有周一系数要加上。

## 关于板块

- 即所属板块的量能，计算方式与股票量能一致。最好能找到股票所在版块的指数。

## 关于势（即股票惯性）：

用四小时（也就是日线）级别的，都不需要盘中做，提前头一天晚上就做好了。因为我们其实是用花车昨天的方向来确定今天的势。

# 4 Variations

vote()功能可以保留，strength()可以改进为用AI训练而成 
